!function($){"use strict";var e={initialize:function(){$(".erp-hr-depts").on("click","a#erp-new-dept",this.department.create),$(".erp-hr-depts").on("click","a.submitdelete",this.department.remove),$(".erp-hr-depts").on("click","span.edit a",this.department.edit),$(".erp-hr-designation").on("click","a#erp-new-designation",this.designation.create),$(".erp-hr-designation").on("click","a.submitdelete",this.designation.remove),$(".erp-hr-designation").on("click","span.edit a",this.designation.edit),$(".erp-hr-employees").on("click","a#erp-employee-new",this.employee.create),$(".erp-hr-employees").on("click","span.edit a",this.employee.edit),$(".erp-hr-employees").on("click","a.submitdelete",this.employee.remove),$(".erp-hr-employees").on("click","a#erp-empl-status",this.employee.updateJobStatus),$(".erp-hr-employees").on("click","a#erp-empl-compensation",this.employee.updateJobStatus),$(".erp-hr-employees").on("click","a#erp-empl-jobinfo",this.employee.updateJobStatus),$(".erp-hr-employees").on("click","td.action a.remove",this.employee.removeHistory),$(".erp-hr-employees").on("click","a#erp-empl-add-exp",this.employee.general.create),$(".erp-hr-employees").on("click","a.work-experience-edit",this.employee.general.create),$(".erp-hr-employees").on("click","a.work-experience-delete",this.employee.general.remove),$(".erp-hr-employees").on("click","a#erp-empl-add-education",this.employee.general.create),$(".erp-hr-employees").on("click","a.education-edit",this.employee.general.create),$(".erp-hr-employees").on("click","a.education-delete",this.employee.general.remove),$(".erp-hr-employees").on("click","a#erp-empl-add-dependent",this.employee.general.create),$(".erp-hr-employees").on("click","a.dependent-edit",this.employee.general.create),$(".erp-hr-employees").on("click","a.dependent-delete",this.employee.general.remove),$(".erp-hr-employees").on("submit",".note-tab-wrap form",this.employee.addNote),$("body").on("click","a#erp-set-emp-photo",this.employee.setPhoto),$("body").on("click","a.erp-remove-photo",this.employee.removePhoto)},initDateField:function(){$(".erp-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0})},reloadPage:function(){$(".erp-area-left").load(window.location.href+" #erp-area-left-inner")},department:{reload:function(){$("#erp-dept-table-wrap").load(window.location.href+" table.department-list-table")},create:function(t){t.preventDefault(),$.erpPopup({title:wpErpHr.popup.dept_title,button:wpErpHr.popup.dept_submit,content:wp.template("erp-new-dept")(),extraClass:"smaller",onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){e.department.reload(),t.closeModal()},error:function(e){alert(e)}})}})},edit:function(t){t.preventDefault();var a=$(this);$.erpPopup({title:wpErpHr.popup.dept_update,button:wpErpHr.popup.dept_update,content:wp.template("erp-new-dept")(),extraClass:"smaller",onReady:function(){var e=this;$("header",e).after($('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-dept",{data:{id:a.data("id"),_wpnonce:wpErpHr.nonce},success:function(t){$(".loader",e).remove(),$("#dept-title",e).val(t.name),$("#dept-desc",e).val(t.data.description),$("#dept-parent",e).val(t.data.parent),$("#dept-id",e).val(t.id),$("#dept-action",e).val("erp-hr-update-dept"),$('#dept-parent option[value="'+a.data("id")+'"]',e).attr("disabled","disabled")}})},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){e.department.reload(),t.closeModal()},error:function(e){alert(e)}})}})},remove:function(e){e.preventDefault();var t=$(this);confirm(wpErpHr.delConfirmDept)&&wp.ajax.send("erp-hr-del-dept",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){$(this).remove()})},error:function(e){alert(e)}})}},designation:{reload:function(){$("#erp-desig-table-wrap").load(window.location.href+" table.designation-list-table")},create:function(t){t.preventDefault(),$.erpPopup({title:wpErpHr.popup.desig_title,button:wpErpHr.popup.desig_submit,content:wp.template("erp-new-desig")(),extraClass:"smaller",onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){e.designation.reload(),t.closeModal()},error:function(e){alert(e)}})}})},edit:function(t){t.preventDefault();var a=$(this);$.erpPopup({title:wpErpHr.popup.desig_update,button:wpErpHr.popup.desig_update,content:wp.template("erp-new-desig")(),extraClass:"smaller",onReady:function(){var e=this;$("header",e).after($('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-desig",{data:{id:a.data("id"),_wpnonce:wpErpHr.nonce},success:function(t){$(".loader",e).remove(),$("#desig-title",e).val(t.name),$("#desig-desc",e).val(t.data.description),$("#desig-id",e).val(t.id),$("#desig-action",e).val("erp-hr-update-desig")}})},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){e.designation.reload(),t.closeModal()},error:function(e){alert(e)}})}})},remove:function(e){e.preventDefault();var t=$(this);confirm(wpErpHr.delConfirmDept)&&wp.ajax.send("erp-hr-del-desig",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){$(this).remove()})},error:function(e){alert(e)}})}},employee:{setPhoto:function(e){e.preventDefault(),e.stopPropagation();var t;return t?void t.open():(t=wp.media({title:wpErpHr.emp_upload_photo,button:{text:wpErpHr.emp_set_photo}}),t.on("select",function(){var e=t.state().get("selection");e.map(function(e){e=e.toJSON();var t='<img src="'+e.url+'" alt="" />';t+='<input type="hidden" id="emp-photo-id" name="personal[photo_id]" value="'+e.id+'" />',t+='<a href="#" class="erp-remove-photo">&times;</a>',$(".photo-container",".erp-employee-form").html(t)})}),void t.open())},removePhoto:function(e){e.preventDefault();var t='<a href="#" id="erp-set-emp-photo" class="button button-small">'+wpErpHr.emp_upload_photo+"</a>";t+='<input type="hidden" name="personal[photo_id]" id="emp-photo-id" value="0">',$(".photo-container",".erp-employee-form").html(t)},create:function(t){"undefined"!=typeof t&&t.preventDefault(),"undefined"!=typeof wpErpHr.employee_empty&&$.erpPopup({title:wpErpHr.popup.employee_title,button:wpErpHr.popup.employee_create,content:wp.template("erp-new-employee")(wpErpHr.employee_empty),onReady:function(){e.initDateField()},onSubmit:function(e){$("button[type=submit]",".erp-modal").attr("disabled","disabled"),wp.ajax.send("erp-hr-employee-new",{data:this.serialize(),success:function(t){var a=wp.template("erp-employee-row");t["class"]="hello",$("table.erp-employee-list-table").append(a(t)),e.closeModal()},error:function(t){e.enableButton(),alert(t)}})}})},edit:function(t){t.preventDefault();var a=$(this);$.erpPopup({title:wpErpHr.popup.employee_update,button:wpErpHr.popup.employee_update,onReady:function(){var t=this;$("header",t).after($('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-emp-get",{data:{id:a.data("id"),_wpnonce:wpErpHr.nonce},success:function(a){var o=wp.template("erp-new-employee")(a);$(".content",t).html(o),$(".loader",t).remove(),e.initDateField(),$("li[data-selected]",t).each(function(){var e=$(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),$('#work_reporting_to option[value="'+a.id+'"]',t).attr("disabled","disabled")}})},onSubmit:function(e){e.disableButton(),wp.ajax.send({data:this.serialize(),success:function(t){var o=a.data("single")===!0?!0:!1;if(o)$(".erp-area-left").load(window.location.href+" #erp-area-left-inner");else{var n=wp.template("erp-employee-row");t["class"]=a.closest("tr").attr("class"),a.closest("tr").replaceWith(n(t))}e.closeModal()},error:function(e){alert(e)}})}})},remove:function(e){e.preventDefault();var t=$(this);confirm(wpErpHr.delConfirmEmployee)&&wp.ajax.send("erp-hr-emp-delete",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){$(this).remove()})},error:function(e){alert(e)}})},general:{create:function(t){"undefined"!=typeof t&&t.preventDefault();var a=$(this);$.erpPopup({title:a.data("title"),content:wp.template(a.data("template"))(a.data("data")),extraClass:"smaller",button:a.data("button"),onReady:function(){e.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){e.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),alert(e)}})}})},remove:function(t){t.preventDefault();var a=$(this);confirm(wpErpHr.confirm)&&wp.ajax.send(a.data("action"),{data:{id:a.data("id"),_wpnonce:wpErpHr.nonce},success:function(){e.reloadPage()}})}},updateJobStatus:function(t){"undefined"!=typeof t&&t.preventDefault();var a=$(this);$.erpPopup({title:a.data("title"),button:wpErpHr.popup.update_status,content:"",extraClass:"smaller",onReady:function(){var t=wp.template(a.data("template"))(window.wpErpCurrentEmployee);$(".content",this).html(t),e.initDateField(),$(".row[data-selected]",this).each(function(){var e=$(this),t=e.data("selected");""!==t&&e.find("select").val(t)})},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){e.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),alert(e)}})}})},removeHistory:function(t){t.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send("erp-hr-emp-delete-history",{data:{id:$(this).data("id"),_wpnonce:wpErpHr.nonce},success:function(){e.reloadPage()}})},addNote:function(e){e.preventDefault();var t=$(this),a=t.find("input[type=submit]");a.attr("disabled","disabled"),wp.ajax.send({data:t.serializeObject(),success:function(){$.get(window.location.href,function(e){$(".note-tab-wrap").replaceWith($(e).find(".note-tab-wrap"))})},error:function(){a.removeAttr("disabled")}})}}};$(function(){e.initialize()})}(jQuery);